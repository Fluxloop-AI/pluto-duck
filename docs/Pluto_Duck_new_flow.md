# Pluto Duck: Local Agentic Data Workbench

ì‘ì„±ì¼: 2026-01-07  
ìƒíƒœ: Draft  
ê´€ë ¨: `docs/plans/deepagents-backend-migration.md`

---

## 1. ì„œë¹„ìŠ¤ ì •ì˜

### í•µì‹¬ ì»¨ì…‰: "Chat to Artifact"

ëŒ€í™”ëŠ” **ìˆ˜ë‹¨**ì´ê³ , ëª©ì ì€ **ê´€ë¦¬ ê°€ëŠ¥í•œ ìì‚°(Artifact)**ì„ ë‚¨ê¸°ëŠ” ê²ƒ.

- **í•µì‹¬ ì² í•™**: "Chat is ephemeral, State is persistent."  
  (ì±„íŒ…ì€ íœ˜ë°œë˜ì§€ë§Œ, ìƒíƒœëŠ” íŒŒì¼ê³¼ DBì— ë‚¨ëŠ”ë‹¤)
- **ì•„í‚¤í…ì²˜ íŒ¨í„´**: Local-First, File-System based State, DuckDB as the Engine
- **UX ë©”íƒ€í¬**: **Studio (ê³µë°©)** â€” ì±„íŒ…ì°½(ì‘ì—… ì§€ì‹œ)ê³¼ ì›Œí¬ë²¤ì¹˜(ê²°ê³¼ë¬¼ ë³´ë“œ/í…Œì´ë¸”)ê°€ ê³µì¡´

### ì´ ì‹œìŠ¤í…œì´ í•´ê²°í•˜ëŠ” ë¬¸ì œ

| ê¸°ì¡´ ë¬¸ì œ | í•´ê²°ì±… |
|----------|--------|
| ì™¸ë¶€ DBì™€ ë‚´ë¶€ DuckDB ë™ê¸°í™” í˜¼ë€ | **Zero-Copy Federation** â€” Live Queryê°€ ê¸°ë³¸ |
| Import ëŒ€ê¸° ì‹œê°„ | **ì—°ê²° ì¦‰ì‹œ ë¶„ì„** â€” ATTACH í›„ ë°”ë¡œ ì¿¼ë¦¬ |
| ê°€ê³µ(íŒŒì´í”„ë¼ì¸ vs ì¼íšŒì„±) ê°œë… ëª¨í˜¸ | **Saved Analysis** â€” ëª…í™•í•œ ìì‚° ë‹¨ìœ„ |
| Chat ê¸°ë°˜ UXì˜ ê°€ì‹œì„± ë¶€ì¡± | **Registry First** â€” í™ˆ í™”ë©´ì´ ìì‚° ëª©ë¡ |

---

## 2. DuckDB Federation í™œìš©

### DuckDB Extensions í˜„í™©

| Extension | ëŒ€ìƒ | ê¸°ëŠ¥ |
|-----------|------|------|
| `postgres` | PostgreSQL | ATTACH + Live Query |
| `mysql` | MySQL/MariaDB | ATTACH + Live Query |
| `sqlite` | SQLite | ATTACH + Live Query |
| `httpfs` | S3, GCS, HTTP | Parquet/CSV ì§ì ‘ ì½ê¸° |
| `iceberg` | Iceberg Tables | ë ˆì´í¬í•˜ìš°ìŠ¤ |
| `delta` | Delta Lake | ë ˆì´í¬í•˜ìš°ìŠ¤ |

```sql
-- Postgres ë°”ë¡œ ë¶™ì–´ì„œ ì¿¼ë¦¬
ATTACH 'postgresql://user:pass@host/db' AS pg (TYPE POSTGRES);
SELECT * FROM pg.public.orders WHERE created_at > '2024-01-01';

-- S3ì˜ Parquet ë°”ë¡œ ì½ê¸°
SELECT * FROM read_parquet('s3://bucket/data/*.parquet');

-- ì—¬ëŸ¬ ì†ŒìŠ¤ ì¡°ì¸ë„ ê°€ëŠ¥!
SELECT o.*, c.name 
FROM pg.orders o 
JOIN read_csv('customers.csv') c ON o.customer_id = c.id;
```

---

## 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜: 3-Zone Model

### ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PLUTO DUCK: LOCAL AGENTIC DATA WORKBENCH             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                    EXTERNAL SOURCES                           â”‚    â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚   â”‚   â”‚Postgres â”‚  â”‚  MySQL  â”‚  â”‚   S3    â”‚  â”‚  Files  â”‚        â”‚    â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚            â”‚            â”‚            â”‚                    â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                        â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                        â”‚   ATTACH    â”‚  â† ì—°ê²°ë§Œ. ë°ì´í„° ë³µì‚¬ X        â”‚
â”‚                        â”‚ (Live Link) â”‚                                 â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                               â”‚                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      LOCAL DUCKDB                               â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚   â”‚  RAW ZONE (Source Attach)                                â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ pg.public.orders       â†’ Live Query to Postgres       â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ mysql_db.sales         â†’ Live Query to MySQL          â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ s3://bucket/events/*   â†’ Live Query to S3             â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€» Zero-Copy: ë°ì´í„° ì €ì¥ ì—†ìŒ, ë©”íƒ€ë°ì´í„°ë§Œ ë³´ê´€         â”‚  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                           â†“                                     â”‚  â”‚
â”‚   â”‚                    (í•„ìš”ì‹œ ìºì‹œ)                                 â”‚  â”‚
â”‚   â”‚                           â†“                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚   â”‚  WORK ZONE (Session Cache)                               â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ cache.orders_2024      â† ë¬´ê±°ìš´ ë¶„ì„ìš© ë¡œì»¬ ë³µì‚¬ë³¸      â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ temp.daily_summary     â† ì„ì‹œ ì§‘ê³„ ê²°ê³¼                 â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€» TTL ê¸°ë°˜ ì‚­ì œ ë˜ëŠ” ëŒ€í™” ì¢…ë£Œ ì‹œ ì •ë¦¬                    â”‚  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                           â†“                                     â”‚  â”‚
â”‚   â”‚                    (ë¶„ì„ ìì‚°í™”)                                 â”‚  â”‚
â”‚   â”‚                           â†“                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚   â”‚  ASSET ZONE (Materialized)                               â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ analysis.monthly_revenue  â† Saved Analysis ê²°ê³¼       â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€¢ analysis.customer_cohort  â† ì¬ì‹¤í–‰ ê°€ëŠ¥í•œ ë¶„ì„         â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â€» ì˜êµ¬ ì €ì¥, Parquet íŒŒì¼ë¡œ ë°±ì—… ê°€ëŠ¥                    â”‚  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                                                                 â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3-Zone ì •ì˜

| Zone | ì´ë¦„ | ì„¤ëª… | ìˆ˜ëª… | ì˜ˆì‹œ |
|------|------|------|------|------|
| **Raw** | Source Attach | ì™¸ë¶€ ì—°ê²° (Live Query) | ì—°ê²° ì„¤ì •ë§Œ ì €ì¥ | `pg.orders` |
| **Work** | Session Cache | ë¶„ì„ ì¤‘ ì„ì‹œ ë°ì´í„° | TTL ë˜ëŠ” ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì‚­ì œ | `cache.orders_2024` |
| **Asset** | Materialized | ì €ì¥ëœ ë¶„ì„ ê²°ê³¼ | ì˜êµ¬ | `analysis.monthly_revenue` |

### ë¬¼ë¦¬ì  ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
~/.pluto-duck/
â”œâ”€â”€ warehouse.duckdb              # ë©”ì¸ DB (ë©”íƒ€ë°ì´í„° + Asset Zone)
â”œâ”€â”€ sessions/
â”‚   â””â”€â”€ {conversation_id}/
â”‚       â””â”€â”€ work.duckdb           # Work Zone (ì„ì‹œ, TTL í›„ ì‚­ì œ)
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ {analysis_id}/
â”‚       â””â”€â”€ result.parquet        # Asset Zone (ì˜êµ¬ íŒŒì¼)
â”œâ”€â”€ connections/
â”‚   â””â”€â”€ {source_id}.json          # Raw Zone (ì—°ê²° ì„¤ì •ë§Œ)
â””â”€â”€ deepagents/
    â”œâ”€â”€ user/
    â”‚   â””â”€â”€ agent.md              # ì‚¬ìš©ì ë©”ëª¨ë¦¬
    â””â”€â”€ projects/{project_id}/
        â”œâ”€â”€ agent.md              # í”„ë¡œì íŠ¸ ë©”ëª¨ë¦¬
        â””â”€â”€ skills/               # í”„ë¡œì íŠ¸ ìŠ¤í‚¬
```

---

## 4. Deepagents ëŸ°íƒ€ì„ íŠ¹ì„± ì—°ê³„

### í•µì‹¬ ëŸ°íƒ€ì„ íŠ¹ì„±

| íŠ¹ì„± | ì„¤ëª… | ë°ì´í„° ì‹œìŠ¤í…œ ì—°ê³„ |
|------|------|-------------------|
| **Virtual FS** | `/workspace/`, `/memories/`, `/skills/` | ì¤‘ê°„ ì‚°ì¶œë¬¼ì„ íŒŒì¼ë¡œ offload |
| **Todo/Skill ë£¨í”„** | ë°˜ë³µ ê°€ëŠ¥í•œ ì›Œí¬í”Œë¡œ íŒ¨í„´í™” | ë¶„ì„ í…œí”Œë¦¿ìœ¼ë¡œ í™œìš© |
| **Tool-first ì‹¤í–‰** | ë„ë©”ì¸ tool í˜¸ì¶œì´ íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ | `run_sql`, `cache_table`, `save_analysis` |
| **HITL ê²Œì´íŒ…** | ìŠ¹ì¸/ê±°ë¶€/í¸ì§‘ + ì¬ê°œ | ë°ì´í„° ë³€ê²½ ì‘ì—…ì— ì ìš© |
| **No shell ì •ì±…** | DB/FS/toolë¡œë§Œ ì‘ì—… ì™„ê²° | DuckDB API ì§ì ‘ í˜¸ì¶œ |
| **ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°** | SSEë¡œ reasoning/tool/message | ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© í‘œì‹œ |

### Agent í–‰ë™ ê·œì¹™

```markdown
## Data Access Strategy

1. **íƒìƒ‰/ë¯¸ë¦¬ë³´ê¸°**: Live Query (Raw Zone)
   - "í…Œì´ë¸” ë³´ì—¬ì¤˜" â†’ SELECT * FROM pg.orders LIMIT 10
   - ë¹ ë¥´ê³  ê°€ë²¼ì›€, í•­ìƒ ìµœì‹ 
   
2. **ë¶„ì„ ì¿¼ë¦¬**: ìƒí™©ì— ë”°ë¼ íŒë‹¨
   - ê°„ë‹¨í•œ ì§‘ê³„ â†’ Live Query (ì›ë³¸ì—ì„œ ì§‘ê³„)
   - ë³µì¡í•œ ë¶„ì„ â†’ Smart Cache ì œì•ˆ
     - "ë°ì´í„°ê°€ ë§ë„¤ìš”(Xì´ˆ ì´ìƒ/Y GB ì´ìƒ). ë¡œì»¬ì— ìºì‹œí• ê¹Œìš”?"
   
3. **ë°˜ë³µ ë¶„ì„**: Saved Analysis
   - "ì´ê±° ë‚˜ì¤‘ì—ë„ ë³¼ê±°ì•¼" â†’ Analysisë¡œ ì €ì¥
   - "ë§¤ì£¼ ë³´ê³  ì‹¶ì–´" â†’ refresh_schedule ì„¤ì •
```

---

## 5. í•µì‹¬ ì›Œí¬í”Œë¡œ: 4ë‹¨ê³„ ë£¨í”„

### â‘  Intent & Plan (Todo ë£¨í”„)

```
User: "ì§€ë‚œì£¼ ë§ˆì¼€íŒ… ë°ì´í„°ë¥¼ ë¶„ì„í•´ì„œ ì±„ë„ë³„ ROI ë³´ì—¬ì¤˜"

Agent: (write_todos ì‹¤í–‰)
       Plan:
       1. CSV ì†ŒìŠ¤ ì—°ê²° (Source)
       2. ë°ì´í„° ì •ì œ ë° ì¡°ì¸ (Transform)
       3. ì§‘ê³„ í…Œì´ë¸” ìƒì„± (Materialization)
       4. ì°¨íŠ¸ ì‹œê°í™” (Artifact)

UX: ì±„íŒ…ì°½ ìš°ì¸¡ì— "Plan íŒ¨ë„" ì‹¤ì‹œê°„ ê°±ì‹ 
```

### â‘¡ Execution & Gating (HITL)

```
Agent: "ë‹¤ìŒ SQLì„ ì‹¤í–‰í• ê¹Œìš”?"
       
       CREATE TABLE cache.marketing_data AS
       SELECT * FROM read_csv('/workspace/marketing.csv')
       WHERE week >= '2024-W01';

User: [âœ“ ìŠ¹ì¸] / [âœ ìˆ˜ì •] / [âœ— ê±°ë¶€]

Agent: (ìŠ¹ì¸ ì‹œ) ì‹¤í–‰ ë¡œê·¸ SSE ìŠ¤íŠ¸ë¦¬ë°
       "12,345ê±´ ì²˜ë¦¬ ì™„ë£Œ (2.3ì´ˆ)"
```

### â‘¢ Materialization & Asset ì €ì¥ (ìë™ ì œì•ˆ)

Agentê°€ ë¶„ì„ì„ ì™„ë£Œí•˜ë©´ **ìë™ìœ¼ë¡œ Asset ì €ì¥ì„ ì œì•ˆ**í•©ë‹ˆë‹¤.

```
Agent: (ë¶„ì„ ìˆ˜í–‰ í›„)
       "ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤: [ì°¨íŠ¸/í…Œì´ë¸”]"
       
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ ğŸ’¡ ì´ ë¶„ì„ì„ Asset Libraryì— ì €ì¥í• ê¹Œìš”?    â”‚
       â”‚                                             â”‚
       â”‚ [ğŸ’¾ ì €ì¥] [ğŸ“Œ Boardì— ë°”ë¡œ ì¶”ê°€] [ê±´ë„ˆë›°ê¸°] â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User: [ğŸ’¾ ì €ì¥] í´ë¦­

Agent: "ì´ë¦„ì„ ì •í•´ì£¼ì„¸ìš”."
       
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Asset ì €ì¥                                  â”‚
       â”‚                                             â”‚
       â”‚ ì´ë¦„: [ì±„ë„ë³„ ROI ë¶„ì„        ]             â”‚
       â”‚ ê°±ì‹ : [â—‹ ìˆ˜ë™] [â—‹ ë§¤ì¼] [â— ë§¤ì£¼] [â—‹ ë§¤ì›”]  â”‚
       â”‚                                             â”‚
       â”‚ [ì €ì¥]                                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Agent: â†’ Asset Libraryì— Saved Analysis ìƒì„±
       {
         name: "ì±„ë„ë³„ ROI ë¶„ì„",
         sql: "SELECT ...",
         refresh_schedule: "weekly",
         depends_on: ["pg.marketing", "pg.costs"]
       }
       
       "ì €ì¥í–ˆì–´ìš”! Asset Libraryì—ì„œ ì–¸ì œë“  ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆì–´ìš”.
        Boardì—ë„ ì¶”ê°€í• ê¹Œìš”?"
```

### ìë™ ì œì•ˆ ê·œì¹™

| ìƒí™© | ì œì•ˆ |
|------|------|
| ë‹¨ìˆœ ì¡°íšŒ (`SELECT ... LIMIT 10`) | ì œì•ˆ ì•ˆ í•¨ |
| ì§‘ê³„/ë¶„ì„ ì¿¼ë¦¬ | "Assetì— ì €ì¥í• ê¹Œìš”?" ì œì•ˆ |
| ì‚¬ìš©ìê°€ "ì €ì¥í•´ì¤˜" ëª…ì‹œ | ì¦‰ì‹œ ì €ì¥ í”Œë¡œìš° |
| ì´ë¯¸ ì €ì¥ëœ Asset ì¬ì‹¤í–‰ | "ì—…ë°ì´íŠ¸í• ê¹Œìš”?" ì œì•ˆ |

### â‘£ Presentation & Board (ìì‚°í™”)

```
User: "ì´ê±° ë§¤ì¶œ ëŒ€ì‹œë³´ë“œì— ì¶”ê°€í•´ì¤˜"

Agent: â†’ Board Component ìƒì„±
       {
         board_id: "sales-dashboard",
         type: "chart",
         analysis_id: "channel-roi",
         chart_type: "bar"
       }

Board ì—´ ë•Œ:
- last_refreshed_at í™•ì¸
- ì„¤ì •ëœ ì •ì±…(Lazy/On-Access)ì— ë”°ë¼ ìë™ ê°±ì‹ 
```

---

## 6. ì—ì…‹(Asset) ì‹œìŠ¤í…œ

### Asset Library + Board êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workspace (Project)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [ê³ ì • ë©”ë‰´]                                                â”‚
â”‚  â”œâ”€ ğŸ’¬ Chat              â† ì‘ì—… ì§€ì‹œ, ëŒ€í™”                  â”‚
â”‚  â”œâ”€ ğŸ“¦ Asset Library     â† ìì‚°ì´ ìŒ“ì´ëŠ” ê³³ (NEW)          â”‚
â”‚  â”œâ”€ ğŸ“Š Boards            â† ë¦¬í¬íŠ¸ ë§Œë“¤ê³  ë³´ì—¬ì£¼ëŠ” ê³³        â”‚
â”‚  â””â”€ ğŸ”— Data Sources      â† ì—°ê²° ê´€ë¦¬                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Asset Library â†” Board ê´€ê³„

```
Asset Library (ì €ì¥ì†Œ)              Board (í”„ë ˆì  í…Œì´ì…˜)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Assets               â”‚         â”‚ ğŸ“Š ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ         â”‚
â”‚                         â”‚         â”‚                         â”‚
â”‚ â€¢ ì›”ë³„ ë§¤ì¶œ (Analysis)  â”‚â”€â”€â”€â”¬â”€â”€â”€â”€â†’â”‚  [ì›”ë³„ ë§¤ì¶œ ì°¨íŠ¸]       â”‚
â”‚ â€¢ ì½”í˜¸íŠ¸ ë¶„ì„           â”‚   â”‚     â”‚  [ê³ ê°ë³„ í…Œì´ë¸”]        â”‚
â”‚ â€¢ ì±„ë„ë³„ ROI            â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â†’â”‚  [ROI ì¹´ë“œ]            â”‚
â”‚ â€¢ ê³ ê° ì„¸ê·¸ë¨¼íŠ¸         â”‚   â”‚     â”‚                         â”‚
â”‚ â€¢ marketing.csv (File)  â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                         â”‚   â”‚     
â”‚                         â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚   â””â”€â”€â”€â”€â†’â”‚ ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸          â”‚
â”‚                         â”‚         â”‚                         â”‚
â”‚                         â”‚         â”‚  [ì£¼ê°„ ë§¤ì¶œ ì°¨íŠ¸]       â”‚
â”‚                         â”‚         â”‚  [ROI ìš”ì•½]            â”‚
â”‚                         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» ì§ì ‘ ì°¸ì¡°: í•˜ë‚˜ì˜ Assetì´ ì—¬ëŸ¬ Boardì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥
â€» Asset ìˆ˜ì • ì‹œ ëª¨ë“  ì°¸ì¡° Boardì— ë°˜ì˜
```

### ìì‚° ìœ í˜• (Asset Libraryì— í¬í•¨)

| ìœ í˜• | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|------|------|----------|
| **Saved Analysis** | ì¬ì‹¤í–‰ ê°€ëŠ¥í•œ ë¶„ì„ (SQL + ê²°ê³¼) | `warehouse.duckdb:analyses` + `assets/{id}/` |
| **Cached Table** | "ë³´ê´€" ì„ íƒí•œ ìºì‹œ í…Œì´ë¸” | `warehouse.duckdb:cached_tables` |
| **Uploaded File** | ì—…ë¡œë“œí•œ CSV/Parquet ë“± | `assets/files/{id}/` |
| **Report** | Markdown ë¬¸ì„œ | `assets/reports/{id}.md` |

### ê¸°íƒ€ ì‹œìŠ¤í…œ ì—”í‹°í‹° (Asset Library ì™¸ë¶€)

| ìœ í˜• | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|------|------|----------|
| **Connection** | ì™¸ë¶€ ì†ŒìŠ¤ ì—°ê²° ì„¤ì • | `connections/{id}.json` |
| **Board** | ëŒ€ì‹œë³´ë“œ (Asset ì°¸ì¡° ì»´í¬ë„ŒíŠ¸ ëª¨ìŒ) | `warehouse.duckdb:boards` |
| **Work Cache** | ì„ì‹œ ì„¸ì…˜ ìºì‹œ (TTL) | `sessions/{conv}/work.duckdb` |
| **Memory** | ì‚¬ìš©ì/í”„ë¡œì íŠ¸ ë©”ëª¨ë¦¬ | `deepagents/` |
| **Skill** | ë¶„ì„ í…œí”Œë¦¿/ê°€ì´ë“œ | `deepagents/*/skills/` |

### Saved Analysis ë°ì´í„° ëª¨ë¸

```sql
CREATE TABLE analyses (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  project_id TEXT,
  
  -- ë¶„ì„ ë¡œì§
  source_sql TEXT NOT NULL,           -- ì›ë³¸ ì¿¼ë¦¬
  
  -- ìŠ¤ì¼€ì¤„
  refresh_schedule TEXT,              -- "manual", "daily", "weekly", "on_access"
  last_refreshed_at TIMESTAMP,
  
  -- ì¶œë ¥
  result_table TEXT,                  -- "analysis.channel_roi"
  
  -- ë©”íƒ€
  created_by TEXT,                    -- "user" or "agent:{run_id}"
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  tags TEXT[]
);

CREATE TABLE analysis_dependencies (
  analysis_id TEXT REFERENCES analyses(id),
  depends_on_type TEXT,               -- "source", "cache", "analysis"
  depends_on_ref TEXT,                -- "pg.orders" or analysis_id
  PRIMARY KEY (analysis_id, depends_on_type, depends_on_ref)
);
```

---

## 7. UI êµ¬ì¡°: Asset Library + Board

### ë©”ë‰´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workspace: "My Project"                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [ì‚¬ì´ë“œë°” - ê³ ì • ë©”ë‰´]                                      â”‚
â”‚  â”œâ”€ ğŸ’¬ Chat                    â† ëŒ€í™”/ì‘ì—… ì§€ì‹œ             â”‚
â”‚  â”œâ”€ ğŸ“¦ Asset Library           â† ìì‚° ëª©ë¡ (NEW)           â”‚
â”‚  â”œâ”€ ğŸ“Š Boards                  â† ë¦¬í¬íŠ¸/ëŒ€ì‹œë³´ë“œ            â”‚
â”‚  â”‚   â”œâ”€ ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ                                       â”‚
â”‚  â”‚   â”œâ”€ ì£¼ê°„ ë¦¬í¬íŠ¸                                         â”‚
â”‚  â”‚   â””â”€ [+ New Board]                                       â”‚
â”‚  â””â”€ ğŸ”— Data Sources            â† ì—°ê²° ê´€ë¦¬                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Asset Library í™”ë©´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ Asset Library                         [+ New Query]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ” Search...              [All] [Analysis] [Files] [Cache] â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š ì›”ë³„ ë§¤ì¶œ ì¶”ì´                                    â”‚   â”‚
â”‚  â”‚    Type: Analysis  â€¢  Updated: 2h ago  â€¢  Weekly     â”‚   â”‚
â”‚  â”‚    Used in: ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ, ì£¼ê°„ ë¦¬í¬íŠ¸               â”‚   â”‚
â”‚  â”‚    [â–¶ Run] [ğŸ‘ Preview] [âœï¸ Edit] [ğŸ“Œ Add to Board] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“Š ê³ ê° ì½”í˜¸íŠ¸ ë¶„ì„                                  â”‚   â”‚
â”‚  â”‚    Type: Analysis  â€¢  Updated: 3d ago  â€¢  Manual     â”‚   â”‚
â”‚  â”‚    Used in: -                                        â”‚   â”‚
â”‚  â”‚    [â–¶ Run] [ğŸ‘ Preview] [âœï¸ Edit] [ğŸ“Œ Add to Board] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ marketing_2024.csv                               â”‚   â”‚
â”‚  â”‚    Type: File  â€¢  Uploaded: 1w ago  â€¢  12,345 rows   â”‚   â”‚
â”‚  â”‚    Used in: ì±„ë„ ë¶„ì„                                â”‚   â”‚
â”‚  â”‚    [ğŸ‘ Preview] [ğŸ—‘ Delete]                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¾ orders_2024 (Cached)                              â”‚   â”‚
â”‚  â”‚    Type: Cache  â€¢  Cached: 5d ago  â€¢  500K rows      â”‚   â”‚
â”‚  â”‚    Source: pg.orders WHERE year=2024                 â”‚   â”‚
â”‚  â”‚    [ğŸ”„ Refresh] [ğŸ‘ Preview] [ğŸ—‘ Delete]             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Board í™”ë©´ (Asset ì°¸ì¡°)

```
Board: "ë§¤ì¶œ ëŒ€ì‹œë³´ë“œ"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ìƒë‹¨ íˆ´ë°”]  Last Updated: 2h ago   [ğŸ”„ Refresh All]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  ì›”ë³„ ë§¤ì¶œ        â”‚  â”‚  ê³ ê°ë³„ ë§¤ì¶œ      â”‚                â”‚
â”‚  â”‚  (ì°¨íŠ¸)          â”‚  â”‚  (í…Œì´ë¸”)        â”‚                â”‚
â”‚  â”‚  â†’ Asset: ì›”ë³„ ë§¤ì¶œ ì¶”ì´              â”‚                â”‚
â”‚  â”‚  [ğŸ”„] [âš™ï¸]       â”‚  â”‚  [ğŸ”„] [âš™ï¸]       â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  ì£¼ê°„ ì„±ì¥ë¥                           â”‚                  â”‚
â”‚  â”‚  (KPI ì¹´ë“œ)                          â”‚                  â”‚
â”‚  â”‚  â†’ Asset: ì±„ë„ë³„ ROI                 â”‚                  â”‚
â”‚  â”‚  [ğŸ”„] [âš™ï¸]                           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê° ì»´í¬ë„ŒíŠ¸:
- Asset ì§ì ‘ ì°¸ì¡° (analysis_id)
- [ğŸ”„] Refresh â†’ í•´ë‹¹ Asset ì¬ì‹¤í–‰
- [âš™ï¸] Edit â†’ ì°¨íŠ¸ íƒ€ì…/í‘œì‹œ ì˜µì…˜ ë³€ê²½ (Asset SQLì€ Asset Libraryì—ì„œ)
```

### Boardì—ì„œ Asset ì¶”ê°€ í”Œë¡œìš°

```
[ğŸ“Œ Add Component] í´ë¦­ â†’

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add from Asset Library             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Search assets...                â”‚
â”‚                                     â”‚
â”‚  ğŸ“Š ì›”ë³„ ë§¤ì¶œ ì¶”ì´          [Add]   â”‚
â”‚  ğŸ“Š ê³ ê° ì½”í˜¸íŠ¸ ë¶„ì„        [Add]   â”‚
â”‚  ğŸ“Š ì±„ë„ë³„ ROI              [Add]   â”‚
â”‚  ğŸ“ marketing_2024.csv      [Add]   â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Or create new:                     â”‚
â”‚  [+ New Query] [+ Text Block]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Refresh ë™ì‘

```
Asset Libraryì—ì„œ:
[â–¶ Run] â†’ í•´ë‹¹ Assetë§Œ ê°±ì‹ 

Boardì—ì„œ:
[ğŸ”„ Refresh All] â†’ Boardì— í¬í•¨ëœ ëª¨ë“  Assetì˜ ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ ê°±ì‹ 
[ğŸ”„] (ì»´í¬ë„ŒíŠ¸ë³„) â†’ í•´ë‹¹ Assetë§Œ ê°±ì‹ 
```

---

## 8. ì˜ì‚¬ê²°ì • ë ˆë²„ (í™•ì •ëœ ê°’)

| ê²°ì • ì¶• | ê²°ì • | ì´ìœ  |
|---------|------|------|
| **Live vs Cache** | Hybrid (Smart Default) | íƒìƒ‰ì€ Live, ë¬´ê±°ìš°ë©´ ì—ì´ì „íŠ¸ê°€ ìºì‹œ ì œì•ˆ |
| **ê°€ê³µì˜ ë‹¨ìœ„** | Saved Analysis | dbtë³´ë‹¤ ê°€ë²¼ì›€, ì‚¬ìš©ì ì¹œí™”ì  |
| **ê°±ì‹  íŠ¸ë¦¬ê±°** | Lazy Evaluation (On-Access) | ë¡œì»¬ ì•±ì´ë¯€ë¡œ ìŠ¤ì¼€ì¤„ë³´ë‹¤ ì ‘ê·¼ ì‹œ ê°±ì‹  |
| **ê°€ì‹œì„±ì˜ ì¤‘ì‹¬** | Asset Library + Board | Asset Library = ì €ì¥ì†Œ, Board = í”„ë ˆì  í…Œì´ì…˜ |
| **ì‹ ë¢°ì„± ì¥ì¹˜** | Lineage + Run History | ì˜ì¡´ì„± ì¶”ì  + ì‹¤í–‰ ì´ë ¥ |
| **Work Zone** | ë³„ë„ DuckDB íŒŒì¼ | Resume ê°€ëŠ¥, checkpointerì™€ ì¼ê´€ì„± |
| **Asset ì°¸ì¡° ë°©ì‹** | ì§ì ‘ ì°¸ì¡° | Asset ìˆ˜ì • ì‹œ ëª¨ë“  Boardì— ë°˜ì˜ (Single Source of Truth) |
| **Asset ìƒì„±** | Agent ìë™ ì œì•ˆ | ë¶„ì„ í›„ "Assetì— ì €ì¥í• ê¹Œìš”?" ìë™ ì œì•ˆ |

---

## 9. í™•ì •ëœ ê²°ì •: duckpipe (ìì²´ ê²½ëŸ‰ ì—”ì§„)

### ê²°ì •: dbt ì œê±°, ìì²´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œ

dbtë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , **`duckpipe`ë¼ëŠ” ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬**ë¥¼ ê°œë°œí•˜ì—¬ "Invisible Pipeline"ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### ì™œ ì´ ê²°ì •ì¸ê°€

| dbt ë‚´ì¬í™” | duckpipe (ìì²´ ê°œë°œ) |
|-----------|---------------------|
| íŒ¨í‚¤ì§• ë³µì¡ | **íŒ¨í‚¤ì§• ë‹¨ìˆœ** âœ… |
| ê³¼ì‰ ê¸°ëŠ¥ (80% ì•ˆ ì”€) | **í•„ìš”í•œ ê²ƒë§Œ** âœ… |
| íŒŒì¼ ê¸°ë°˜ êµ¬ì¡° | **DB ê¸°ë°˜ (ìš°ë¦¬ ëª¨ë¸ê³¼ ì¼ì¹˜)** âœ… |
| dbt ë²„ì „ ì¢…ì† | **ìì²´ í†µì œ** âœ… |

### duckpipe ê°œìš”

```
duckpipeê°€ í•˜ëŠ” ê²ƒ:
â”œâ”€â”€ SQL ê¸°ë°˜ Analysis ì •ì˜
â”œâ”€â”€ ì˜ì¡´ì„± ìë™ ì¶”ì¶œ (sqlglot)
â”œâ”€â”€ DAG êµ¬ì„± + Topological Sort
â”œâ”€â”€ Materialization (VIEW/TABLE/PARQUET)
â”œâ”€â”€ Freshness ì²´í¬ + Selective Refresh
â””â”€â”€ ì‹¤í–‰ ì´ë ¥ + ìƒíƒœ ê´€ë¦¬

duckpipeê°€ ì•ˆ í•˜ëŠ” ê²ƒ (Pluto Duckì´ í•¨):
â”œâ”€â”€ UI/API
â”œâ”€â”€ Agent/LLM ì—°ë™
â”œâ”€â”€ HITL ìŠ¹ì¸
â””â”€â”€ ì—°ê²° ê´€ë¦¬
```

### ê°œë°œ ì „ëµ

1. **ë‚´ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì‹œì‘**: `backend/duckpipe/`
2. **API ì•ˆì •í™” í›„**: ì™¸ë¶€ OSS/íŒ¨í‚¤ì§€ ë¶„ë¦¬ ê³ ë ¤

ìƒì„¸ ìŠ¤í™: [`docs/plans/duckpipe-spec.md`](./duckpipe-spec.md)

---

## 10. ë‹¤ìŒ ë‹¨ê³„

### êµ¬í˜„ ë¡œë“œë§µ

**Phase 0: duckpipe ê°œë°œ** (2ì£¼) âœ… ì™„ë£Œ
- [x] `backend/duckpipe/` ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬ì¡° ìƒì„±
- [x] Analysis ëª¨ë¸ + Pipeline í´ë˜ìŠ¤
- [x] DAG + topological sort (graphlib)
- [x] sqlglot ê¸°ë°˜ ì˜ì¡´ì„± ì¶”ì¶œ
- [x] ê¸°ë³¸ ì‹¤í–‰ (VIEW/TABLE/APPEND/PARQUET)
- [x] ë©”íƒ€ë°ì´í„° ì €ì¥ (DuckDB `_duckpipe` ìŠ¤í‚¤ë§ˆ)
- [x] Typed Ref Model (ADR-003)
- [x] Safe Parameter Binding (ADR-004)
- [x] Plan before Execute (ADR-005)
- [x] Identifier Safety (ADR-006)
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (62ê°œ í†µê³¼)

**Phase 1: Live + Cache í”Œë¡œìš°** (1ì£¼) âœ… ì™„ë£Œ
- [x] DuckDB ATTACH ê¸°ë°˜ Source ì—°ê²° (`SourceService`)
- [x] `cache_table` / `attach_postgres` / `attach_sqlite` Agent tools
- [x] Smart Cache ì œì•ˆ ë¡œì§ (`suggest_cache` tool)
- [x] Work Zone íŒŒì¼ êµ¬ì¡° (`WorkZoneService`)
- [x] Work Zone TTL ì •ë¦¬ ë¡œì§ (`cleanup_expired()`)
- [x] Source/Cache REST API (`/api/v1/source/*`)
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (42ê°œ í†µê³¼)

**Phase 2: Asset ì‹œìŠ¤í…œ + duckpipe ì—°ë™** (2ì£¼) âœ… ì™„ë£Œ
- [x] AssetService (duckpipe Pipeline ë˜í•‘)
- [x] Asset CRUD REST API (`/api/v1/asset/*`)
- [x] `save_analysis` / `run_analysis` / `list_analyses` Agent tools
- [x] `get_lineage` / `get_freshness` Agent tools
- [x] Freshness ì²´í¬ + ì‹¤í–‰ ì´ë ¥
- [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (28ê°œ í†µê³¼)

> ğŸ“Œ ìƒì„¸ ì—°ë™ ìŠ¤í™ì€ ì•„ë˜ "Asset ì‹œìŠ¤í…œ ì—°ë™ ìƒì„¸ ìŠ¤í™" ì„¹ì…˜ ì°¸ì¡°
> ğŸ’¡ Agent ìë™ ì œì•ˆ ë¡œì§ì€ Phase 3 UI êµ¬í˜„ í›„ Agent prompt ìµœì í™”ì™€ í•¨ê»˜ ì§„í–‰

**Phase 3: UI - Asset Library** (2ì£¼) âœ… ì™„ë£Œ
- [x] Asset Library API í´ë¼ì´ì–¸íŠ¸ (`assetsApi.ts`)
- [x] Asset Library ë©”ë‰´ ì¶”ê°€ (Sidebar íƒ­ ì „í™˜)
- [x] Asset ëª©ë¡ í™”ë©´ (`AssetListView`)
- [x] Asset ìƒì„¸/í¸ì§‘ ëª¨ë‹¬ (`AssetDetailModal`)
- [x] Asset ìƒì„± ëª¨ë‹¬ (`CreateAssetModal`)
- [x] ì‹¤í–‰ ê³„íš ë¯¸ë¦¬ë³´ê¸° (`ExecutionPlanView`)
- [ ] Boardì—ì„œ Asset ì°¸ì¡° êµ¬í˜„ (í–¥í›„)
- [x] On-Access Refresh âœ…

**Phase 4: ì•ˆì •í™”** âœ… ì™„ë£Œ!
- [x] Lineage ì‹œê°í™” (React Flow ê¸°ë°˜ ê·¸ë˜í”„ ë·°) âœ…
- [x] ì—ëŸ¬ í•¸ë“¤ë§ / ë¶€ë¶„ ì‹¤íŒ¨ (`continue_on_failure` ì˜µì…˜) âœ…
- [x] Asset ê²€ìƒ‰/í•„í„° ê³ ë„í™” (íƒœê·¸, íƒ€ì…, ìƒíƒœ, ì •ë ¬) âœ…
- [x] Boardì—ì„œ Asset ì°¸ì¡° (`/asset` ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´) âœ…
- [ ] (ì„ íƒ) duckpipe OSS ë¶„ë¦¬

---

## 11. Asset ì‹œìŠ¤í…œ ì—°ë™ ìƒì„¸ ìŠ¤í™

> Phase 2 ì‹œì‘ ì‹œ ì°¸ì¡°í•  duckpipe â†” Pluto Duck ì—°ë™ ì„¤ê³„

### 11.1 ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Pluto Duck Backend                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ AssetServiceâ”‚â”€â”€â”€â–¶â”‚  duckpipe   â”‚â”€â”€â”€â–¶â”‚  DuckDB     â”‚         â”‚
â”‚  â”‚  (ë˜í•‘)     â”‚    â”‚  Pipeline   â”‚    â”‚  (ì‹¤í–‰)     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚        â”‚                  â–²                                     â”‚
â”‚        â”‚                  â”‚ YAML                                â”‚
â”‚        â–¼                  â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ Asset API   â”‚    â”‚ FileStore   â”‚                            â”‚
â”‚  â”‚ (REST)      â”‚    â”‚ (analyses/) â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚        â”‚                                                        â”‚
â”‚        â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    Agent Tools                               â”‚â”‚
â”‚  â”‚  save_analysis â”‚ run_analysis â”‚ list_analyses â”‚ get_lineage â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 AssetService ì„¤ê³„

```python
# backend/pluto_duck_backend/app/services/asset/service.py

from duckpipe import Pipeline, Analysis, ExecutionPlan
from duckpipe.storage import FileMetadataStore

class AssetService:
    """
    duckpipe Pipelineì„ Pluto Duck ì„œë¹„ìŠ¤ ë ˆì´ì–´ë¡œ ë˜í•‘.
    - Connection ê´€ë¦¬ (DuckDB ì—°ê²° ì£¼ì…)
    - í”„ë¡œì íŠ¸ë³„ ê²©ë¦¬
    - ì‹¤í–‰ ì´ë ¥ API
    """
    
    def __init__(self, project_id: str, db_path: Path):
        self.project_id = project_id
        self.db_path = db_path
        self.analyses_dir = db_path.parent / "analyses"
        self.store = FileMetadataStore(self.analyses_dir)
        self._pipeline: Pipeline | None = None
    
    def _get_pipeline(self, conn: duckdb.DuckDBPyConnection) -> Pipeline:
        """Connectionì„ ì£¼ì…ë°›ì•„ Pipeline ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜"""
        if self._pipeline is None:
            self._pipeline = Pipeline(self.store)
        return self._pipeline
    
    # === CRUD ===
    
    async def create_analysis(
        self,
        analysis_id: str,
        sql: str,
        name: str | None = None,
        description: str | None = None,
        materialization: str = "view",
        parameters: list[dict] | None = None,
        tags: list[str] | None = None,
    ) -> Analysis:
        """ìƒˆ Analysis ìƒì„± (YAML íŒŒì¼ë¡œ ì €ì¥)"""
        analysis = Analysis(
            id=analysis_id,
            sql=sql,
            name=name or analysis_id,
            description=description,
            materialization=materialization,
            parameters=parameters or [],
            tags=tags or [],
        )
        self.store.save(analysis)
        return analysis
    
    async def get_analysis(self, analysis_id: str) -> Analysis | None:
        """Analysis ì¡°íšŒ"""
        return self.store.load(analysis_id)
    
    async def list_analyses(self, tags: list[str] | None = None) -> list[Analysis]:
        """ëª¨ë“  Analysis ëª©ë¡ (íƒœê·¸ í•„í„° ê°€ëŠ¥)"""
        all_analyses = self.store.list_all()
        if tags:
            return [a for a in all_analyses if set(tags) & set(a.tags)]
        return all_analyses
    
    async def update_analysis(self, analysis_id: str, **updates) -> Analysis:
        """Analysis ìˆ˜ì •"""
        analysis = self.store.load(analysis_id)
        if not analysis:
            raise AssetNotFoundError(analysis_id)
        
        for key, value in updates.items():
            if hasattr(analysis, key):
                setattr(analysis, key, value)
        
        self.store.save(analysis)
        return analysis
    
    async def delete_analysis(self, analysis_id: str) -> None:
        """Analysis ì‚­ì œ"""
        self.store.delete(analysis_id)
    
    # === ì‹¤í–‰ ===
    
    async def compile_analysis(
        self,
        analysis_id: str,
        conn: duckdb.DuckDBPyConnection,
        params: dict | None = None,
    ) -> ExecutionPlan:
        """
        ì‹¤í–‰ ê³„íš ìƒì„± (HITL ìŠ¹ì¸ìš©)
        - Agentê°€ ì‚¬ìš©ìì—ê²Œ ì‹¤í–‰ ê³„íš ë³´ì—¬ì£¼ê¸° ì „ í˜¸ì¶œ
        """
        pipeline = self._get_pipeline(conn)
        return pipeline.compile(analysis_id, params=params)
    
    async def execute_plan(
        self,
        plan: ExecutionPlan,
        conn: duckdb.DuckDBPyConnection,
    ) -> ExecutionResult:
        """
        ìŠ¹ì¸ëœ ì‹¤í–‰ ê³„íš ì‹¤í–‰
        - HITL ìŠ¹ì¸ í›„ í˜¸ì¶œ
        """
        pipeline = self._get_pipeline(conn)
        return pipeline.execute(plan, conn)
    
    async def run_analysis(
        self,
        analysis_id: str,
        conn: duckdb.DuckDBPyConnection,
        params: dict | None = None,
    ) -> ExecutionResult:
        """
        ì¦‰ì‹œ ì‹¤í–‰ (ìŠ¹ì¸ ì—†ì´)
        - ì´ë¯¸ ìŠ¹ì¸ëœ Analysis ì¬ì‹¤í–‰ ì‹œ ì‚¬ìš©
        """
        plan = await self.compile_analysis(analysis_id, conn, params)
        return await self.execute_plan(plan, conn)
    
    # === ìƒíƒœ ì¡°íšŒ ===
    
    async def get_freshness(
        self,
        analysis_id: str,
        conn: duckdb.DuckDBPyConnection,
    ) -> dict:
        """
        Analysis ì‹ ì„ ë„ ìƒíƒœ ì¡°íšŒ
        - last_run_at: ë§ˆì§€ë§‰ ì‹¤í–‰ ì‹œê°„
        - is_stale: ì¬ì‹¤í–‰ í•„ìš” ì—¬ë¶€
        - stale_reason: stale ì‚¬ìœ  (ì˜ì¡´ì„± ë³€ê²½ ë“±)
        """
        pipeline = self._get_pipeline(conn)
        return pipeline.get_freshness_status(analysis_id, conn)
    
    async def get_lineage(
        self,
        analysis_id: str,
        conn: duckdb.DuckDBPyConnection,
    ) -> dict:
        """
        Lineage ì •ë³´ ì¡°íšŒ
        - upstream: ì˜ì¡´í•˜ëŠ” Analysis/Source ëª©ë¡
        - downstream: ì´ Analysisì— ì˜ì¡´í•˜ëŠ” Analysis ëª©ë¡
        """
        pipeline = self._get_pipeline(conn)
        return {
            "upstream": pipeline.get_upstream(analysis_id),
            "downstream": pipeline.get_downstream(analysis_id),
        }
    
    async def get_run_history(
        self,
        analysis_id: str,
        conn: duckdb.DuckDBPyConnection,
        limit: int = 10,
    ) -> list[dict]:
        """ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ"""
        result = conn.execute("""
            SELECT run_id, started_at, finished_at, status, error_message, row_count
            FROM _duckpipe.run_history
            WHERE analysis_id = ?
            ORDER BY started_at DESC
            LIMIT ?
        """, [analysis_id, limit]).fetchall()
        
        return [
            {
                "run_id": r[0],
                "started_at": r[1],
                "finished_at": r[2],
                "status": r[3],
                "error_message": r[4],
                "row_count": r[5],
            }
            for r in result
        ]
```

### 11.3 Agent Tools ì„¤ê³„

```python
# backend/pluto_duck_backend/agent/core/deep/tools/asset.py

@tool(name="save_analysis")
async def save_analysis(
    sql: str,
    name: str,
    description: str | None = None,
    materialization: Literal["view", "table", "append", "parquet"] = "view",
    parameters: list[dict] | None = None,
    tags: list[str] | None = None,
) -> str:
    """
    í˜„ì¬ ë¶„ì„ì„ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ Assetìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    
    Args:
        sql: ì €ì¥í•  SQL ì¿¼ë¦¬
        name: Asset ì´ë¦„ (ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•íƒœ)
        description: ì„¤ëª… (ì„ íƒ)
        materialization: ì €ì¥ ë°©ì‹
            - view: ê°€ìƒ ë·° (ì‹¤í–‰ ì‹œ ê³„ì‚°)
            - table: ì‹¤ì œ í…Œì´ë¸” (ê²°ê³¼ ì €ì¥)
            - append: ê¸°ì¡´ í…Œì´ë¸”ì— ì¶”ê°€
            - parquet: Parquet íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
        parameters: ë™ì  íŒŒë¼ë¯¸í„° ì •ì˜ (ì„ íƒ)
        tags: ë¶„ë¥˜ íƒœê·¸ (ì„ íƒ)
    
    Returns:
        ì €ì¥ëœ Analysis ID
    """
    # Agent contextì—ì„œ ì„œë¹„ìŠ¤ ë° ì—°ê²° íšë“
    asset_service = get_asset_service()
    
    # ID ìƒì„± (nameì„ snake_caseë¡œ ë³€í™˜)
    analysis_id = to_snake_case(name)
    
    analysis = await asset_service.create_analysis(
        analysis_id=analysis_id,
        sql=sql,
        name=name,
        description=description,
        materialization=materialization,
        parameters=parameters,
        tags=tags,
    )
    
    return f"âœ… '{name}' Assetì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ID: {analysis_id})"


@tool(name="run_analysis")
async def run_analysis(
    analysis_id: str,
    params: dict | None = None,
    force: bool = False,
) -> str:
    """
    ì €ì¥ëœ Analysisë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
    
    Args:
        analysis_id: ì‹¤í–‰í•  Analysis ID
        params: íŒŒë¼ë¯¸í„° ê°’ (íŒŒë¼ë¯¸í„°ê°€ ì •ì˜ëœ ê²½ìš° í•„ìˆ˜)
        force: Trueë©´ freshness ìƒê´€ì—†ì´ ê°•ì œ ì‹¤í–‰
    
    Returns:
        ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
    """
    asset_service = get_asset_service()
    conn = get_duckdb_connection()
    
    # Freshness ì²´í¬
    if not force:
        freshness = await asset_service.get_freshness(analysis_id, conn)
        if not freshness["is_stale"]:
            return f"â„¹ï¸ '{analysis_id}'ëŠ” ì´ë¯¸ ìµœì‹  ìƒíƒœì…ë‹ˆë‹¤. (ë§ˆì§€ë§‰ ì‹¤í–‰: {freshness['last_run_at']})"
    
    # ì‹¤í–‰ ê³„íš ìƒì„± (HITL ìŠ¹ì¸ìš©)
    plan = await asset_service.compile_analysis(analysis_id, conn, params)
        
    # ì‹¤í–‰ ê³„íšì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê³  ìŠ¹ì¸ ìš”ì²­
    # (Agent frameworkì˜ HITL ë©”ì»¤ë‹ˆì¦˜ í™œìš©)
    approval_message = format_execution_plan(plan)
    
    # ìŠ¹ì¸ í›„ ì‹¤í–‰
    result = await asset_service.execute_plan(plan, conn)
    
    return format_execution_result(result)


@tool(name="list_analyses")
async def list_analyses(
    tags: list[str] | None = None,
    show_freshness: bool = False,
) -> str:
    """
    ì €ì¥ëœ Analysis ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    Args:
        tags: í•„í„°ë§í•  íƒœê·¸ ëª©ë¡ (ì„ íƒ)
        show_freshness: Trueë©´ ê° Analysisì˜ ì‹ ì„ ë„ ìƒíƒœë„ í‘œì‹œ
    
    Returns:
        Analysis ëª©ë¡ (í…Œì´ë¸” í˜•ì‹)
    """
    asset_service = get_asset_service()
    conn = get_duckdb_connection()
    
    analyses = await asset_service.list_analyses(tags)
    
    if not analyses:
        return "ì €ì¥ëœ Analysisê°€ ì—†ìŠµë‹ˆë‹¤."
    
    # í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ í¬ë§·
    rows = []
    for a in analyses:
        row = {
            "ID": a.id,
            "Name": a.name,
            "Type": a.materialization,
            "Tags": ", ".join(a.tags) if a.tags else "-",
        }
        
        if show_freshness:
            freshness = await asset_service.get_freshness(a.id, conn)
            row["Status"] = "ğŸŸ¢ Fresh" if not freshness["is_stale"] else "ğŸŸ¡ Stale"
            row["Last Run"] = freshness.get("last_run_at", "-")
        
        rows.append(row)
    
    return format_as_table(rows)


@tool(name="get_lineage")
async def get_lineage(analysis_id: str) -> str:
    """
    Analysisì˜ ë°ì´í„° ê³„ë³´(Lineage)ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    Args:
        analysis_id: ì¡°íšŒí•  Analysis ID
    
    Returns:
        ìƒìœ„/í•˜ìœ„ ì˜ì¡´ì„± íŠ¸ë¦¬
    """
    asset_service = get_asset_service()
    conn = get_duckdb_connection()
    
    lineage = await asset_service.get_lineage(analysis_id, conn)
    
    return format_lineage_tree(lineage)
```

### 11.4 Asset REST API ì„¤ê³„

```python
# backend/pluto_duck_backend/app/api/v1/asset/router.py

router = APIRouter(prefix="/asset", tags=["asset"])

# CRUD
@router.post("/analyses", response_model=AnalysisResponse)
async def create_analysis(request: CreateAnalysisRequest): ...

@router.get("/analyses", response_model=list[AnalysisResponse])
async def list_analyses(tags: list[str] = Query(None)): ...

@router.get("/analyses/{analysis_id}", response_model=AnalysisResponse)
async def get_analysis(analysis_id: str): ...

@router.patch("/analyses/{analysis_id}", response_model=AnalysisResponse)
async def update_analysis(analysis_id: str, request: UpdateAnalysisRequest): ...

@router.delete("/analyses/{analysis_id}")
async def delete_analysis(analysis_id: str): ...

# ì‹¤í–‰
@router.post("/analyses/{analysis_id}/compile", response_model=ExecutionPlanResponse)
async def compile_analysis(analysis_id: str, request: CompileRequest): ...

@router.post("/analyses/{analysis_id}/execute", response_model=ExecutionResultResponse)
async def execute_analysis(analysis_id: str, request: ExecuteRequest): ...

# ìƒíƒœ
@router.get("/analyses/{analysis_id}/freshness", response_model=FreshnessResponse)
async def get_freshness(analysis_id: str): ...

@router.get("/analyses/{analysis_id}/lineage", response_model=LineageResponse)
async def get_lineage(analysis_id: str): ...

@router.get("/analyses/{analysis_id}/history", response_model=list[RunHistoryResponse])
async def get_run_history(analysis_id: str, limit: int = 10): ...
```

### 11.5 Agent ìë™ ì œì•ˆ ë¡œì§

```python
# backend/pluto_duck_backend/agent/core/deep/hooks/asset_suggestion.py

class AssetSuggestionHook:
    """
    Agentê°€ ë³µì¡í•œ ë¶„ì„ì„ ì™„ë£Œí–ˆì„ ë•Œ Asset ì €ì¥ì„ ì œì•ˆí•˜ëŠ” í›….
    
    ì œì•ˆ ì¡°ê±´:
    1. SQLì´ ì¼ì • ë³µì¡ë„ ì´ìƒ (JOIN 2ê°œ ì´ìƒ, CTE ì‚¬ìš© ë“±)
    2. ê°™ì€ íŒ¨í„´ì˜ ì¿¼ë¦¬ê°€ 2íšŒ ì´ìƒ ë°˜ë³µë¨
    3. ì‚¬ìš©ìê°€ "ì´ê±° ì €ì¥í•´", "ë‚˜ì¤‘ì— ë˜ ë³¼ê²Œ" ë“±ì˜ ì˜ë„ í‘œí˜„
    """
    
    COMPLEXITY_THRESHOLD = 3  # JOIN/CTE/SUBQUERY ê°œìˆ˜
    
    async def on_query_complete(
        self,
        sql: str,
        result: QueryResult,
        context: AgentContext,
    ) -> str | None:
        """ì¿¼ë¦¬ ì™„ë£Œ í›„ í˜¸ì¶œ, ì œì•ˆ ë©”ì‹œì§€ ë°˜í™˜"""
        
        # ë³µì¡ë„ ë¶„ì„
        complexity = self._analyze_complexity(sql)
        
        if complexity >= self.COMPLEXITY_THRESHOLD:
            return self._format_suggestion(sql, result)
        
        # ë°˜ë³µ íŒ¨í„´ ê°ì§€
        if self._is_repeated_pattern(sql, context):
            return self._format_suggestion(sql, result)
        
        return None
    
    def _analyze_complexity(self, sql: str) -> int:
        """SQL ë³µì¡ë„ ì ìˆ˜ ê³„ì‚°"""
        import sqlglot
        
        score = 0
        parsed = sqlglot.parse_one(sql)
        
        # JOIN ê°œìˆ˜
        score += len(list(parsed.find_all(sqlglot.exp.Join)))
        
        # CTE ê°œìˆ˜
        score += len(list(parsed.find_all(sqlglot.exp.CTE)))
        
        # Subquery ê°œìˆ˜
        score += len(list(parsed.find_all(sqlglot.exp.Subquery)))
        
        # Window function ì‚¬ìš©
        if list(parsed.find_all(sqlglot.exp.Window)):
            score += 1
        
        return score
    
    def _format_suggestion(self, sql: str, result: QueryResult) -> str:
        return (
            "ğŸ’¡ ì´ ë¶„ì„ì„ Assetìœ¼ë¡œ ì €ì¥í•˜ì‹œê² ì–´ìš”?\n"
            "ì €ì¥í•˜ë©´ ë‚˜ì¤‘ì— ë°”ë¡œ ì‹¤í–‰í•˜ê±°ë‚˜ Boardì— ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.\n\n"
            f"```sql\n{sql}\n```\n\n"
            "ì €ì¥í•˜ë ¤ë©´ 'ì €ì¥í•´ì¤˜' ë˜ëŠ” 'ì›”ë³„_ë§¤ì¶œ_ë¶„ì„ìœ¼ë¡œ ì €ì¥í•´ì¤˜'ë¼ê³  í•´ì£¼ì„¸ìš”."
        )
```

### 11.6 Board â†” Asset ì—°ë™

```typescript
// frontend/pluto_duck_frontend/components/boards/AssetBlock.tsx

interface AssetBlockProps {
  analysisId: string;
  params?: Record<string, unknown>;
  refreshOnLoad?: boolean;
}

/**
 * Boardì—ì„œ Assetì„ ì°¸ì¡°í•˜ëŠ” ë¸”ë¡.
 * - ê²°ê³¼ í…Œì´ë¸”/ì°¨íŠ¸ ë Œë”ë§
 * - On-Access Refresh ì§€ì›
 * - íŒŒë¼ë¯¸í„° ë°”ì¸ë”© UI
 */
export function AssetBlock({ analysisId, params, refreshOnLoad }: AssetBlockProps) {
  const { data: analysis } = useQuery(['analysis', analysisId], () => 
    fetchAnalysis(analysisId)
  );
  
  const { data: freshness } = useQuery(['freshness', analysisId], () =>
    fetchFreshness(analysisId)
  );
  
  const executeMutation = useMutation(executeAnalysis);
  
  // On-Access Refresh
  useEffect(() => {
    if (refreshOnLoad && freshness?.is_stale) {
      executeMutation.mutate({ analysisId, params });
    }
  }, [refreshOnLoad, freshness]);
  
  // ... ë Œë”ë§ ë¡œì§
}
```

### 11.7 ë ˆê±°ì‹œ ì½”ë“œ ì •ë¦¬ âœ… ì™„ë£Œ (2026-01-09)

duckpipeì™€ SourceServiceë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„, ë ˆê±°ì‹œ ì½”ë“œë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

#### ì‚­ì œëœ í•­ëª©

| ë¶„ë¥˜ | ì‚­ì œëœ íŒŒì¼/í´ë” | ëŒ€ì²´ |
|------|------------------|------|
| **DBT** | `app/services/transformation/` | duckpipe |
| **DBT** | `app/api/v1/dbt/` | `/api/v1/asset` |
| **DBT** | `agent/tools/dbt.py` | `agent/tools/asset.py` |
| **DBT** | `templates/dbt/` | - |
| **Ingestion** | `app/services/ingestion/` | SourceService.cache_table |
| **Ingestion** | `app/api/v1/ingest/` | `/api/v1/source` |
| **Ingestion** | `agent/tools/ingest.py` | `agent/tools/source.py` |
| **data_sources** | `app/services/data_sources/` | SourceService |
| **data_sources** | `app/api/v1/data_sources/` | `/api/v1/source` |

#### í†µí•©ëœ ì‹œìŠ¤í…œ

```
ê¸°ì¡´:
  data_sources (ë©”íƒ€ë°ì´í„°) + ingestion (ë°ì´í„° ë³µì‚¬) + dbt (ë³€í™˜)
  â†’ 3ê°œ ì‹œìŠ¤í…œì´ ë¶„ë¦¬ë˜ì–´ í˜¼ë€

í˜„ì¬:
  SourceService (ATTACH + Cache) + duckpipe (Analysis ê´€ë¦¬)
  â†’ 2ê°œ ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©, ëª…í™•í•œ ì—­í•  ë¶„ë¦¬
```

#### í”„ë¡ íŠ¸ì—”ë“œ í˜¸í™˜ì„±

`dataSourcesApi.ts`ëŠ” `sourceApi.ts`ë¥¼ ë˜í•‘í•˜ëŠ” í˜¸í™˜ì„± ë ˆì´ì–´ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
ì‹ ê·œ ì½”ë“œëŠ” `sourceApi.ts`ë¥¼ ì§ì ‘ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ë¶€ë¡: ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì—°ê²° â†’ ì¦‰ì‹œ íƒìƒ‰

```
User: "íšŒì‚¬ Postgres DB ì—°ê²°í•´ì¤˜"
Agent: (ATTACH ì‹¤í–‰)
       "ì—°ê²°ëì–´ìš”. í…Œì´ë¸” ëª©ë¡:"
       - public.orders (Live)
       - public.customers (Live)
       - public.products (Live)

User: "orders ì¢€ ë³´ì—¬ì¤˜"
Agent: SELECT * FROM pg.orders LIMIT 5
       (ì‹¤ì‹œê°„ ê²°ê³¼ í‘œì‹œ)
       
User: "ì´ ëª‡ ê±´ì´ì•¼?"
Agent: SELECT COUNT(*) FROM pg.orders
       â†’ "1,234,567ê±´ì´ì—ìš”"
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë¬´ê±°ìš´ ë¶„ì„ â†’ Smart Cache

```
User: "2024ë…„ ì „ì²´ ì£¼ë¬¸ìœ¼ë¡œ ì½”í˜¸íŠ¸ ë¶„ì„ í•´ì¤˜"

Agent: (íŒë‹¨: ë°ì´í„° ë§ìŒ)
       "ë°ì´í„°ê°€ ì•½ 50ë§Œ ê±´ì´ë„¤ìš”. 
        ë¡œì»¬ì— ìºì‹œí•˜ë©´ ë¶„ì„ì´ ë¹¨ë¼ì ¸ìš”. ìºì‹œí• ê¹Œìš”?"

User: "ì‘"

Agent: CREATE TABLE cache.orders_2024 AS 
       SELECT * FROM pg.orders 
       WHERE order_date >= '2024-01-01';
       
       "50ë§Œ ê±´ì„ ë¡œì»¬ë¡œ ê°€ì ¸ì™”ì–´ìš”. (3.2ì´ˆ)"
       
       (ë¡œì»¬ í…Œì´ë¸” ëŒ€ìƒìœ¼ë¡œ ë³µì¡í•œ ì½”í˜¸íŠ¸ ë¶„ì„ ìˆ˜í–‰)
       
       "ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤: ..."
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë¶„ì„ ìì‚°í™”

```
User: "ì´ ì›”ë³„ ë§¤ì¶œ ë¶„ì„, ë§¤ë‹¬ ë³´ê³  ì‹¶ì–´"

Agent: "Saved Analysisë¡œ ì €ì¥í• ê²Œìš”."
       
       Name: "ì›”ë³„ ë§¤ì¶œ ì¶”ì´"
       SQL: SELECT DATE_TRUNC('month', order_date) as month,
                   SUM(amount) as revenue
            FROM pg.orders
            GROUP BY 1
       Schedule: Weekly
       
       "ì €ì¥í–ˆì–´ìš”. ë‹¤ìŒì— 'ì›”ë³„ ë§¤ì¶œ ì—…ë°ì´íŠ¸í•´ì¤˜'ë¼ê³  í•˜ê±°ë‚˜,
        Registryì—ì„œ [â–¶] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìµœì‹  ë°ì´í„°ë¡œ ê°±ì‹ ë¼ìš”."

User: (ì¼ì£¼ì¼ í›„, Registryì—ì„œ)
      [â–¶ Run Now] í´ë¦­

System: "ìµœì‹  ë°ì´í„°ë¡œ ê°±ì‹ í–ˆì–´ìš”. (2.1ì´ˆ)"
```
